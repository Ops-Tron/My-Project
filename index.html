<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nile Testnet Activation</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 600px;
            margin: 2rem auto;
            padding: 0 1rem;
            text-align: center;
        }

        .button {
            background: #2e58ff;
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: opacity 0.2s;
            display: inline-block;
            text-decoration: none;
        }

        .button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }

        .qr-code {
            margin: 2rem 0;
            border: 1px solid #eee;
            padding: 1rem;
            border-radius: 8px;
        }

        .manual-steps {
            text-align: left;
            margin-top: 2rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <h1>Activate Nile Testnet</h1>
    
    <button class="button" id="activateButton">Activate Now</button>

    <div id="fallback" style="display: none;">
        <div class="qr-code">
            <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=https://nile.tronscan.org" 
                 alt="Scan for Nile Activation">
            <p>Scan QR Code with TronLink App</p>
        </div>

        <div class="manual-steps">
            <h3>Manual Activation Steps:</h3>
            <ol>
                <li>Open TronLink Mobile App</li>
                <li>Go to Settings â†’ Network</li>
                <li>Select <strong>Nile Testnet</strong></li>
                <li>Use RPC URL: <code>https://nile.trongrid.io</code></li>
            </ol>
        </div>
    </div>

    <script>
        (function() {
            const ACTIVATION_DATA = {
                contract: 'TNUC9Qb1rSaSxXzXCViBZDZT6f4cZ6JKEy',
                function: 'activate()',
                chainId: '0x2b6653dc'
            };

            const button = document.getElementById('activateButton');
            const fallback = document.getElementById('fallback');

            // Platform Detection
            const isAndroid = /Android/i.test(navigator.userAgent);
            const isiOS = /iPhone|iPad/i.test(navigator.userAgent);
            const isMobile = isAndroid || isiOS;

            // Core Activation Function
            async function activateNile() {
                button.disabled = true;
                button.textContent = 'Initializing...';

                try {
                    // Generate TronLink deeplink
                    const params = encodeURIComponent(JSON.stringify({
                        contract_address: ACTIVATION_DATA.contract,
                        function_selector: ACTIVATION_DATA.function,
                        parameter: "0x",
                        chainId: ACTIVATION_DATA.chainId
                    }));

                    const deeplink = tronlink://test.nile/tronlink/tronlink?params=${params};

                    // Platform-specific handling
                    if(isAndroid) {
                        window.location.href = deeplink;
                    } else if(isiOS) {
                        // iOS requires user interaction
                        const link = document.createElement('a');
                        link.href = deeplink;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    }

                    // Success detection
                    setTimeout(() => {
                        if(!document.hidden) {
                            showFallback();
                        }
                    }, 2000);

                } catch(error) {
                    showFallback();
                }
            }

            function showFallback() {
                button.style.display = 'none';
                fallback.style.display = 'block';
            }

            // Event Listeners
            button.addEventListener('click', () => {
                if(!isMobile) {
                    alert('Please open on a mobile device');
                    return;
                }
                activateNile();
            });

            // Initial mobile check
            if(!isMobile) {
                button.style.display = 'none';
                showFallback();
            }
        })();
    </script>
</body>
</html>
